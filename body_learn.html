<!--
[仕様メモ / body_learn.html]

役割:
- 出題・解答トグル・正誤記録・進捗表示・結果カード。

コントロール/進捗:
- #preset            … 出題範囲（all/poly/trig/exp/log 等のプリセット）
- #mode              … モード（once/debug 等）
- #btnStartSession   … 現プリセットでセッション開始
- #btnReset          … 学習ログ消去→ 表示更新
- #statCur / #statTotal … 出題数/総数
- #prog              … 進捗バーの幅（%）

操作ボタン:
- #btnShowPolicy / #btnShowAns / #btnShowExplain … 各トグル表示
- #btnCorrect / #btnWrong / #btnNext … 記録→遷移

表示ラッパ:
- #qWrap / #qBox … 問題（常時表示）
- #pWrap / #pBox … 方針（初期非表示）
- #aWrap / #aBox … 答え（初期非表示）
- #eWrap / #eBox … 解説（初期非表示）
- #meta … 進行中セッションのメタ表示（現在ラベルなど）
- #perItemStat / #itemShown / #itemCorrect / #itemAcc … この問題の累積

結果カード:
- #viewResult（初期非表示）
- #resultMeta / #resultSummary
- #btnRetryWrong … 直前の範囲内で「shown>0 && correct==0」のみ再挑戦
- #btnBackHome  … タイトルへ戻る

使用クラス:
- .card .meta .ghost .select .kx（共通UI）
- 進捗バーは .progress-rail/.progress-bar を使ってもよい（現在は id 指定）

ロジック前提:
- 記録は localStorage("integral_hell_logs"): { [label]: { shown, correct } } に累積。
- 最終問題では #viewResult を表示し、ボタンで再挑戦/ホーム戻る。
- 表示更新の都度、必要部分に MathJax の typeset を適用。
-->

<section id="learn-main" style="display:flex; flex-direction:column; gap:18px;">

  <!-- コントロール（範囲 / モード / 開始 / リセット） -->
  <div class="card" style="background:#151820; border-radius:12px; padding:16px;">
    <div class="row" style="display:flex; gap:12px; flex-wrap:wrap; align-items:center;">
      <label>出題範囲
        <select id="preset" class="select">
          <option value="all">全ジャンル</option>
          <option value="poly">多項式</option>
          <option value="trig">三角</option>
          <option value="exp">指数</option>
          <option value="log">対数</option>
        </select>
      </label>

      <label>モード
        <select id="mode" class="select">
          <option value="once">1周して結果表示</option>
          <option value="debug">デバッグ（順番固定）</option>
        </select>
      </label>

      <button id="btnStartSession" class="ghost">開始</button>
      <button id="btnReset" class="ghost">成績リセット</button>

      <div style="margin-left:auto;">
        出題: <span id="statCur">0</span>/<span id="statTotal">0</span>
      </div>
    </div>
    <div class="bar" style="height:10px; background:#101626; border:1px solid #2a3248; border-radius:999px; overflow:hidden; margin-top:10px;">
      <span id="prog" style="display:block; height:100%; background:linear-gradient(90deg,#3abff8,#60a5fa); width:0%;"></span>
    </div>
  </div>

  <!-- ボタン群 -->
  <div id="ctrlWrap" class="card" style="background:#151820; border-radius:12px; padding:12px; display:flex; flex-wrap:wrap; gap:12px; justify-content:center;">
    <button id="btnShowPolicy" class="ghost">方針を表示</button>
    <button id="btnShowAns" class="ghost">答えを表示</button>
    <button id="btnShowExplain" class="ghost">解説を表示</button>
    <button id="btnCorrect" class="ghost">正解</button>
    <button id="btnWrong" class="ghost">不正解</button>
    <button id="btnNext" class="ghost">次の問題へ</button>
  </div>

  <div class="meta" id="meta"></div>

  <!-- この問題の成績 -->
  <div class="meta" id="perItemStat" style="margin:6px 0 10px;">
    この問題: <span id="itemShown">0</span> 回挑戦 ／
    <span id="itemCorrect">0</span> 回正解 ／
    正答率 <span id="itemAcc">0%</span>
  </div>

  <!-- 問題 -->
  <div class="card" id="qWrap" style="background:#151820; border-radius:12px; padding:16px;">
    <div class="meta">問題</div>
    <div id="qBox" class="kx" style="min-height:80px;"></div>
  </div>

  <!-- 方針（トグル） -->
  <div id="pWrap" class="card" style="background:#151820; border-radius:12px; padding:16px; display:none;">
    <div class="meta">方針</div>
    <div id="pBox" class="kx" style="min-height:60px;"></div>
  </div>

  <!-- 答え（トグル） -->
  <div id="aWrap" class="card" style="background:#151820; border-radius:12px; padding:16px; display:none;">
    <div class="meta">答え</div>
    <div id="aBox" class="kx" style="min-height:40px;"></div>
  </div>

  <!-- 解説（トグル） -->
  <div id="eWrap" class="card" style="background:#151820; border-radius:12px; padding:16px; display:none;">
    <div class="meta">解説</div>
    <div id="eBox" class="kx" style="min-height:80px;"></div>
  </div>

  <!-- 結果画面 -->
  <div id="viewResult" class="card" style="display:none; background:#151820; border-radius:12px; padding:16px;">
    <h2 style="margin:0 0 8px;">結果</h2>
    <div class="meta" id="resultMeta"></div>
    <div class="kx" id="resultSummary" style="margin-top:10px;"></div>
    <div class="controls" style="display:flex; gap:12px; margin-top:14px;">
      <button id="btnRetryWrong" class="ghost">「前回の間違いのみ」で再挑戦</button>
      <button id="btnBackHome" class="ghost">ホームに戻る</button>
    </div>
  </div>
</section>
